---
import Layout from '../../layouts/Layout.astro';
import { isAuthenticated } from '../../lib/auth';

if (isAuthenticated(Astro.cookies)) {
  return Astro.redirect('/admin');
}
---

<Layout title="Admin Login | Pratham Sarawad">
  <div class="min-h-screen flex items-center justify-center pt-20">
    <div class="cyber-card p-10 max-w-md w-full">
      <h1 class="text-3xl font-bold text-primary mb-6 text-center glitch-text" data-text="SYSTEM_ACCESS">SYSTEM_ACCESS</h1>
      
      <form id="login-form" class="space-y-6">
        <div>
          <label class="block text-sm font-mono text-primary mb-2">USER_ID</label>
          <input type="text" name="username" class="w-full bg-[#0a0a0f] border border-white/10 p-3 text-white focus:border-primary outline-none text-sm font-mono" required />
        </div>
        
        <div>
          <label class="block text-sm font-mono text-primary mb-2">ACCESS_KEY</label>
          <input type="password" name="password" class="w-full bg-[#0a0a0f] border border-white/10 p-3 text-white focus:border-primary outline-none text-sm font-mono" required />
        </div>
        
        <div id="error-msg" class="text-red-500 text-xs font-mono hidden">
           ACCESS_DENIED: Invalid credentials
        </div>

        <button type="submit" class="w-full bg-primary text-black font-bold py-3 hover:bg-white transition-colors uppercase tracking-widest font-mono">
            [ INITIALIZE_SESSION ]
        </button>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById('login-form');
    const errorMsg = document.getElementById('error-msg');

    form?.addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target as HTMLFormElement);
        
        try {
            const res = await fetch('/api/auth/login', {
                method: 'POST',
                body: formData
            });
            
            if (res.ok) {
                window.location.href = '/admin';
            } else {
                errorMsg?.classList.remove('hidden');
            }
        } catch (err) {
            console.error(err);
        }
    });
  </script>
</Layout>